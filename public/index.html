<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PAW-ID ‚Ä¢ Instant Pet Breed Identifier</title>

  <!-- External CSS -->
  <link rel="stylesheet" href="/styles.css">
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
  />
</head>

<body>

<header>
  <div class="container header-inner">
    <div class="brand-left">
      <div class="paw-logo">üêæ</div>
      <a class="brand" href="#">
        <span class="brand-title">PAW-ID</span>
        <span class="brand-sub">Instant Pet Breed Identifier</span>
      </a>
    </div>

    <nav>
      <ul>
        <li><a href="#">Home</a></li>
        <li><a href="#detect">Detect</a></li>
      </ul>
    </nav>
  </div>
</header>

<section class="hero-wrap">
  <div class="hero-card hero-center">
    <h1>Welcome to PAW-ID</h1>
    <p class="hero-sub">
      Upload a photo of your pet and identify its breed instantly.
    </p>
  </div>
</section>

<section id="detect" class="detection-section">
  <h2>Detect PAW-ID</h2>
  <p class="detect-sub">Upload an image of your pet</p>

  <input type="file" id="imageInput" accept="image/*" hidden>

  <div class="image-preview-area" id="uploadArea">
    <p id="previewPlaceholder">No image selected</p>
    <img id="imagePreview" style="display:none;">
  </div>

  <button id="analyzeImageBtn" class="analyze-btn" disabled>
    <i class="fas fa-search"></i> Analyze Image
  </button>
</section>

<div id="result-card" class="card hidden">
  <div class="card-header">
    <h2 id="main-breed">Breed</h2>
    <span id="badge" class="badge"></span>
  </div>

  <p id="explanation" class="explanation"></p>
  <div id="confidence-list"></div>
</div>

<script>
const imageInput = document.getElementById("imageInput");
const imagePreview = document.getElementById("imagePreview");
const analyzeBtn = document.getElementById("analyzeImageBtn");
const uploadArea = document.getElementById("uploadArea");
const placeholder = document.getElementById("previewPlaceholder");

let currentFile = null;

// click upload area
uploadArea.addEventListener("click", () => imageInput.click());

// preview
imageInput.addEventListener("change", () => {
  const file = imageInput.files[0];
  if (!file) return;

  currentFile = file;
  const reader = new FileReader();

  reader.onload = e => {
    imagePreview.src = e.target.result;
    imagePreview.style.display = "block";
    placeholder.style.display = "none";
    analyzeBtn.disabled = false;
  };

  reader.readAsDataURL(file);
});

// analyze
analyzeBtn.addEventListener("click", async () => {
  if (!currentFile) return;

  analyzeBtn.disabled = true;
  analyzeBtn.textContent = "Analyzing...";

  try {
    const reader = new FileReader();
    reader.onload = async () => {
      const res = await fetch("/api/upload", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ image: reader.result })
      });

      const data = await res.json();
      renderResult(data);
    };
    reader.readAsDataURL(currentFile);
  } catch (e) {
    alert("Analysis failed");
  } finally {
    analyzeBtn.disabled = false;
    analyzeBtn.innerHTML = '<i class="fas fa-search"></i> Analyze Image';
  }
});

function renderResult(data) {
  const card = document.getElementById("result-card");
  const mainBreed = document.getElementById("main-breed");
  const badge = document.getElementById("badge");
  const explanation = document.getElementById("explanation");
  const list = document.getElementById("confidence-list");

  card.classList.remove("hidden");
  list.innerHTML = "";

  const preds = data.predictions || [];
  if (!preds.length) return;

  const top = preds[0];
  mainBreed.textContent = top.class;
  badge.textContent = preds.length > 1 ? "MIXED BREED" : "PURE";
  badge.className = preds.length > 1 ? "badge mixed" : "badge pure";

  explanation.textContent = "Detected breed confidence levels:";

  preds.forEach(p => {
    const percent = (p.confidence * 100).toFixed(1);
    list.innerHTML += `
      <div class="breed-row">
        <strong>${p.class} (${percent}%)</strong>
        <div class="progress">
          <div class="progress-bar" style="width:${percent}%"></div>
        </div>
      </div>
    `;
  });
}
</script>

</body>
</html>
